---
title: "Homework 5"
author: Sanjana Batabyal 
output: github_document
---

This is my solution to Homework 5.

```{r}
library(tidyverse)
library(magrittr)
library(dplyr)
library(ggplot2)
```

## Problem 1
Getting the data from the csv file downloaded from GitHub. Cleaning the data, creating a "resolved" variable, and creating a "city_state" variable.
```{r}
homicide=
  read_csv("data/homicide-data.csv") %>%
  mutate(
    city_state=str_c(city, state, sep="_"),
    resolved=case_when(
    disposition=="Closed without arrest" ~ "unsolved",
    disposition=="Closed by arrest" ~ "solved",
    disposition=="Open/No arrest" ~ "unsolved")
  ) %>%
  select(city_state, resolved) %>%
  filter(city_state != "Tulsa_AL")
```
Filtering the data to group total number of homicides and total number of unsolved homicides by location.
```{r}
agg_hom=
homicide %>%
  group_by(city_state) %>%
  summarize(
    hom_tot=n(),
    hom_unsolved=sum(resolved=="unsolved"),
  )
```
Doing a prop.test on the unsolved homicides in Baltimore, MD. 
```{r}
prop.test(
  agg_hom %>% filter(city_state=="Baltimore_MD") %>% pull(hom_unsolved),
  agg_hom %>% filter(city_state=="Baltimore_MD") %>% pull(hom_tot)
) %>%
  broom::tidy()
```
Iterating such that we perform a prop.test on each city in the data set.
```{r}
hom_results=
agg_hom %>%
  mutate(
    prop_tests=map2(.x=hom_unsolved, .y=hom_tot, ~prop.test(x=.x, n=.y)),
    tidy_tests=map(.x=prop_tests, ~broom::tidy(.x))
  ) %>%
  select(-prop_tests) %>%
  unnest(tidy_tests) %>%
  select(city_state, estimate, conf.low, conf.high)
```
Plotting the results from the previous step.
```{r}
agg_hom %>%
  ggplot(aes(x=city_state, y=estimate)) +
  geom_point()
```